[[release-notes-5.0.0-beta1]]
== 5.0.0-beta1 Release Notes

Also see <<breaking-changes-5.0>>.

IMPORTANT: This is a beta release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-beta1 to any other version is not supported.

[[breaking-5.0.0-beta1]]
[float]
=== Breaking changes

Analysis::
* Remove `token_filter` in _analyze API {pull}20285[#20285] (issue: {issue}20283[#20283])
* Removes support for adding aliases to analyzers {pull}19994[#19994] (issue: {issue}18244[#18244])

CRUD::
* Fixed naming inconsistency for fields/stored_fields in the APIs {pull}20166[#20166] (issues: {issue}18943[#18943], {issue}20155[#20155])
* Disallow creating indices starting with '-' or '+' {pull}20033[#20033] (issue: {issue}19800[#19800])

Core::
* Remove minimum master nodes bootstrap check {pull}20082[#20082]

Engine::
* Optimize indexing for the autogenerated ID append-only case {pull}20211[#20211] (issue: {issue}19813[#19813])

Geo::
* Deprecate GeoDistance enums and remove geo distance script helpers {pull}19783[#19783]

Logging::
* Introduce Log4j 2 {pull}20235[#20235] (issues: {issue}16030[#16030], {issue}17697[#17697])

Packaging::
* Rename service.bat to elasticsearch-service.bat {pull}20496[#20496] (issue: {issue}17528[#17528])
* Remove -D handling in args for windows plugin script {pull}20378[#20378] (issue: {issue}18207[#18207])
* Set default min heap equal to default max heap {pull}20080[#20080] (issues: {issue}16334[#16334], {issue}17728[#17728], {issue}18311[#18311])

Plugin Lang Painless::
* Make Painless the Default Language {pull}20017[#20017] (issue: {issue}19960[#19960])

REST::
* Parameter improvements to Cluster Health API wait for shards {pull}20223[#20223] (issue: {issue}20216[#20216])
* Switch indices.exists_type from `{index}/{type}` to `{index}/_mapping/{type}`. {pull}20055[#20055] (issue: {issue}15613[#15613])
* Only use `PUT` for index creation, not POST. {pull}20001[#20001] (issues: {issue}15613[#15613], {issue}18160[#18160])

Scripting::
* Hardcode painless as the default scripting lang and add legacy script default for stored scripts {pull}20310[#20310] (issue: {issue}20122[#20122])

Settings::
* Default max local storage nodes to one {pull}19964[#19964] (issues: {issue}19679[#19679], {issue}19748[#19748])



[[breaking-java-5.0.0-beta1]]
[float]
=== Breaking Java changes

Core::
* Remove ability to plug-in TransportService {pull}20505[#20505]

Internal::
* Remove TransportService#registerRequestHandler leniency {pull}20469[#20469] (issue: {issue}20468[#20468])
* Consolidate search parser registries {pull}20000[#20000]
* Move all FetchSubPhases to o.e.search.fetch.subphase {pull}19702[#19702]
* Squash the rest of o.e.rest.action {pull}19698[#19698]

Plugins::
* Cleanup sub fetch phase extension point {pull}20382[#20382]
* Remove IndexTemplateFilter {pull}20072[#20072]
* Switch custom ShardsAllocators to pull based model {pull}20071[#20071]
* Make custom allocation deciders use pull based extensions {pull}20040[#20040]

Search::
* Remove FetchSubPhaseParseElement {pull}20350[#20350]



[[deprecation-5.0.0-beta1]]
[float]
=== Deprecations

Geo::
* Deprecate optimize_bbox on geodistance queries {pull}20032[#20032] (issue: {issue}20014[#20014])
* Deprecate geohash parameters for geo_point parser {pull}20030[#20030] (issue: {issue}20009[#20009])

Scripting::
* Deprecate Groovy, Python, and Javascript {pull}20244[#20244] (issue: {issue}20129[#20129])



[[feature-5.0.0-beta1]]
[float]
=== New features

Aliases::
* Add an alias action to delete an index {pull}20184[#20184] (issue: {issue}20064[#20064])

Analysis::
* Exposing lucene 6.x minhash filter. {pull}20206[#20206] (issue: {issue}20149[#20149])

Geo::
* Cut over geo_point field and queries to new LatLonPoint type {pull}20315[#20315] (issue: {issue}20314[#20314])

Plugin Discovery File::
* File-based discovery plugin {pull}20394[#20394] (issue: {issue}20323[#20323])

Search::
* Add the ability to disable the retrieval of the stored fields entirely {pull}20026[#20026]

Suggesters::
* Add support for returning documents with completion suggester {pull}19536[#19536] (issue: {issue}10746[#10746])



[[enhancement-5.0.0-beta1]]
[float]
=== Enhancements

Allocation::
* Change DiskThresholdDecider's behavior when factoring in leaving shards {pull}20349[#20349]
* Verify AllocationIDs in replication actions {pull}20320[#20320]
* Mark shard as stale on non-replicated write, not on node shutdown {pull}20023[#20023] (issue: {issue}18919[#18919])
* Add routing changes API to RoutingAllocation {pull}19992[#19992]
* Primary shard allocator observes limits in forcing allocation {pull}19811[#19811] (issue: {issue}19446[#19446])
* Use primary terms as authority to fail shards {pull}19715[#19715]
* Add recovery source to ShardRouting {pull}19516[#19516]

Analysis::
* Stop using cached component in _analyze API {pull}19929[#19929] (issue: {issue}19827[#19827])

Benchmark::
* Add client-benchmark-noop-api-plugin to stress clients even more in benchmarks {pull}20103[#20103]

CAT API::
* Add health status parameter to cat indices API {pull}20393[#20393]

Circuit Breakers::
* Circuit break the number of inline scripts compiled per minute {pull}19694[#19694] (issue: {issue}19396[#19396])

Cluster::
* Add clusterUUID to RestMainAction output {pull}20503[#20503]

Core::
* Add serial collector bootstrap check {pull}20558[#20558]
* Rename Netty TCP transports thread factories from http_* to transport_* {pull}20207[#20207]
* Do not log full bootstrap checks exception {pull}19989[#19989]
* Mark halting the virtual machine as privileged {pull}19923[#19923] (issues: {issue}19272[#19272], {issue}19806[#19806])

Engine::
* Only try to read new segments info if we really flushed the index {pull}20474[#20474]
* Use _refresh instead of reading from Translog in the RT GET case {pull}20102[#20102]

Exceptions::
* Improve startup exception {pull}20083[#20083]

Index Templates::
* Add "version" field to Templates {pull}20353[#20353] (issue: {issue}20171[#20171])

Ingest::
* Add "version" field to Pipelines {pull}20343[#20343] (issue: {issue}20171[#20171])
* Make it possible for Ingest Processors to access AnalysisRegistry {pull}20233[#20233]
* add ignore_missing option to convert,trim,lowercase,uppercase,grok,rename {pull}20194[#20194] (issue: {issue}19995[#19995])
* Add support for parameters to the script ingest processor {pull}20136[#20136]
* introduce the JSON Processor {pull}20128[#20128] (issue: {issue}20052[#20052])
* Allow rename processor to turn leaf fields into branch fields {pull}20053[#20053] (issue: {issue}19892[#19892])
* remove ability to set field value in script-processor configuration {pull}19981[#19981]

Internal::
* Remove poor-mans compression in InternalSearchHit and friends {pull}20472[#20472]
* Don't register SearchTransportService handlers more than once {pull}20468[#20468]
* Unguice SearchModule {pull}20456[#20456]
* Deguice SearchService and friends {pull}20423[#20423]
* NodeStats classes to implement Writeable rather then Streamable {pull}20327[#20327]
* More info classes to implement Writeable rather than Streamable {pull}20288[#20288] (issue: {issue}20255[#20255])
* Internal: Split disk threshold monitoring from decider {pull}20018[#20018]
* Switching LockObtainFailedException over to ShardLockObtainFailedException {pull}19991[#19991] (issue: {issue}19978[#19978])
* update and delete by query requests to implement IndicesRequest.Replaceable {pull}19961[#19961]
* VersionFetchSubPhase should not use Versions#loadDocIdAndVersion {pull}19944[#19944]

Java API::
* Ensure PutMappingRequest.buildFromSimplifiedDef input are pairs {pull}19837[#19837] (issue: {issue}19836[#19836])

Java REST Client::
* Add support for a RestClient path prefix {pull}20190[#20190]
* Add "Async" to the end of each Async RestClient method {pull}20172[#20172] (issue: {issue}20168[#20168])
* Allow RestClient to send array-based headers {pull}20151[#20151]

Logging::
* Ensure logging is initialized in CLI tools {pull}20575[#20575]
* Give useful error message if log config is missing {pull}20493[#20493]
* Complete Elasticsearch logger names {pull}20457[#20457] (issue: {issue}20326[#20326])
* Add node name to decider trace logging  {pull}20437[#20437] (issue: {issue}20379[#20379])
* Logging shutdown hack {pull}20389[#20389] (issue: {issue}20304[#20304])
* Disable console logging {pull}20387[#20387]
* Skip loading of jansi from log4j2 {pull}20334[#20334]
* Configure AWS SDK logging configuration {pull}20313[#20313] (issue: {issue}20294[#20294])
* Warn if unsupported logging configuration present {pull}20309[#20309]
* Size limit deprecation logs {pull}20287[#20287] (issues: {issue}20235[#20235], {issue}20254[#20254])
* Increase visibility of deprecation logger {pull}20254[#20254] (issue: {issue}11033[#11033])
* Add shardId and node name in search slow log {pull}19949[#19949] (issue: {issue}19735[#19735])

Mapping::
* Automatically downgrade text and keyword to string on indexes imported from 2.x {pull}20177[#20177]
* Do not parse numbers as both strings and numbers when not included in `_all`. {pull}20167[#20167]
* Don't index the `_version` field {pull}20132[#20132]
* The root object mapper should support updating `numeric_detection`, `date_detection` and `dynamic_date_formats`. {pull}20119[#20119] (issue: {issue}20111[#20111])
* Automatically upgrade analyzed string fields that have `index_options` or `position_increment_gap` set. {pull}20002[#20002] (issue: {issue}19974[#19974])
* Mappings: Support dots in field names in mapping parsing {pull}19899[#19899] (issue: {issue}19443[#19443])
* Save one utf8 conversion in KeywordFieldMapper. {pull}19867[#19867]
* Do not parse the created version from the settings every time a field is parsed. {pull}19824[#19824]

Network::
* Avoid early initializing Netty {pull}19819[#19819] (issue: {issue}5644[#5644])
* Network: Allow to listen on virtual interfaces. {pull}19568[#19568] (issues: {issue}17473[#17473], {issue}19537[#19537])

Packaging::
* Add quiet option to disable console logging {pull}20422[#20422] (issues: {issue}15315[#15315], {issue}16159[#16159], {issue}17220[#17220])
* Explicitly disable Netty key set replacement {pull}20249[#20249]

Plugin Lang Painless::
* Disable regexes by default in painless {pull}20427[#20427] (issue: {issue}20397[#20397])
* Catch OutOfMemory and StackOverflow errors in Painless {pull}19936[#19936]

Plugin Repository S3::
* Extract AWS Key from KeyChain instead of using potential null value {pull}19560[#19560] (issues: {issue}18703[#18703], {issue}19557[#19557])

Plugins::
* Print message when removing plugin with config {pull}20338[#20338]
* Plugins: Update official plugin location with unified release {pull}19996[#19996]
* Allow plugins to upgrade global custom metadata on startup {pull}19962[#19962]
* Switch aggregations from push to pull {pull}19839[#19839]
* Display plugins versions {pull}18683[#18683]

Query DSL::
* Throw exception when multiple field names are provided as part of query short syntax {pull}19871[#19871] (issue: {issue}19791[#19791])
* Query parsers to throw exception when multiple field names are provided {pull}19791[#19791] (issue: {issue}19547[#19547])

REST::
* Add exclusion support to response filtering {pull}19865[#19865]

Recovery::
* Pass on maxUnsafeAutoIdTimestamp on recovery / relocation {pull}20300[#20300]

Scripting::
* Parse script on storage instead of on retrieval {pull}20356[#20356]
* Migrate elasticsearch native script examples to the main repo {pull}19334[#19334] (issue: {issue}14662[#14662])

Settings::
* Make `action.auto_create_index` setting a dynamic cluster setting {pull}20274[#20274] (issue: {issue}7513[#7513])
* Removes space between # and the setting in elasticsearch.yml {pull}20094[#20094] (issue: {issue}20090[#20090])

Snapshot/Restore::
* Delete differing files in the store before restoring {pull}20220[#20220] (issue: {issue}20148[#20148])
* Adds ignoreUnavailable option to the snapshot status API {pull}20066[#20066] (issue: {issue}18522[#18522])
* Check restores in progress before deleting a snapshot {pull}19853[#19853]
* Snapshot repository cleans up empty index folders {pull}19751[#19751]

Stats::
* Add mem section back to cluster stats {pull}20255[#20255] (issue: {issue}17278[#17278])
* Add network types to cluster stats {pull}20144[#20144]

Suggesters::
* Move SuggestUtils methods to their respective caller classes {pull}19914[#19914] (issue: {issue}19906[#19906])
* Remove payload option from completion suggester {pull}19877[#19877] (issue: {issue}19536[#19536])

Task Manager::
* Rename Task Persistence into Storing Task Results {pull}19982[#19982]

Translog::
* Fsync documents in an async fashion {pull}20145[#20145]
* Add checksumming and versions to the Translog's Checkpoint files {pull}19797[#19797]



[[bug-5.0.0-beta1]]
[float]
=== Bug fixes

Aggregations::
* Fix agg profiling when using breadth_first collect mode {pull}20156[#20156]
* Throw exception when maxBounds greater than minBounds {pull}19855[#19855] (issue: {issue}19833[#19833])

Allocation::
* Upon being elected as master, prefer joins' node info to existing cluster state {pull}19743[#19743]

Analysis::
* Can load non-PreBuiltTokenFilter in Analyze API {pull}20396[#20396]

CRUD::
* GET operations should not extract fields from `_source`. {pull}20158[#20158] (issues: {issue}15017[#15017], {issue}20102[#20102])

Cache::
* Serialize index boost and phrase suggest collation keys in a consistent order {pull}20081[#20081] (issue: {issue}19986[#19986])

Cluster::
* Fixes issue with dangling index being deleted instead of re-imported {pull}19666[#19666]

Discovery::
* Update discovery nodes after cluster state is published {pull}20409[#20409]
* Add current cluster state version to zen pings and use them in master election {pull}20384[#20384] (issue: {issue}20348[#20348])

Engine::
* Take refresh IOExceptions into account when catching ACE in InternalEngine {pull}20546[#20546] (issue: {issue}19975[#19975])
* Don't suppress AlreadyClosedException {pull}19975[#19975] (issue: {issue}19861[#19861])

Highlighting::
* Fix highlighting of MultiTermQuery within a FunctionScoreQuery {pull}20400[#20400] (issue: {issue}20392[#20392])
* Enable BoostingQuery with FVH highlighter {pull}19984[#19984] (issue: {issue}19985[#19985])

Index APIs::
* Fix IndexNotFoundException in multi index search request. {pull}20188[#20188] (issue: {issue}3839[#3839])

Ingest::
* Don't rebuild pipeline on every cluster state update {pull}20189[#20189]
* Add dotexpander processor {pull}20078[#20078]

Internal::
* Ensure elasticsearch doesn't start with unuspported indices {pull}20514[#20514] (issue: {issue}20512[#20512])
* Remove ListTasksResponse#setDiscoveryNodes() {pull}19773[#19773] (issue: {issue}19772[#19772])

Java API::
* fix IndexResponse#toString to print out shards info {pull}20562[#20562]
* Add NamedWriteables from plugins to TransportClient {pull}19825[#19825] (issue: {issue}19764[#19764])

Logging::
* Avoid unnecessary creation of prefix loggers {pull}20571[#20571] (issue: {issue}20570[#20570])
* Fix logging hierarchy configs {pull}20463[#20463]
* Fix prefix logging {pull}20429[#20429]
* Hack around Log4j bug rendering exceptions {pull}20306[#20306] (issue: {issue}20304[#20304])
* Avoid prematurely triggering logger initialization {pull}20170[#20170]

Mapping::
* Mapping updates on objects should propagate `include_an_all`. {pull}20051[#20051]
* Validate blank field name {pull}19860[#19860] (issue: {issue}19251[#19251])

Network::
* Fix expect 100 continue header handling {pull}19904[#19904] (issue: {issue}19834[#19834])
* Fixes netty4 module's CORS config to use defaults  {pull}19874[#19874]
* Fix various concurrency issues in transport {pull}19675[#19675]

Packaging::
* [Packaging] Do not remove scripts directory on upgrade {pull}20452[#20452]
* [Package] Remove bin/lib/modules directories on RPM uninstall/upgrade {pull}20448[#20448]
* RESTART_ON_UPGRADE incorrectly named ES_RESTART_ON_UPGRADE in sysconfig {pull}19976[#19976] (issue: {issue}19950[#19950])
* Fix handling of spaces for jvm.options on Windows {pull}19951[#19951] (issue: {issue}19941[#19941])

Percolator::
* Fail indexing percolator queries containing either a has_child or has_parent query {pull}20229[#20229] (issue: {issue}2960[#2960])

Plugin Ingest Attachment::
* Adds content-length as number {pull}19927[#19927] (issue: {issue}19924[#19924])

Plugin Ingest GeoIp::
* [ingest-geoip] update geoip to not include null-valued results from  {pull}20455[#20455]

Plugin Lang Painless::
* Fix break bug in for/foreach loops. {pull}20146[#20146]

Plugins::
* Use sysprop like with es.path.home to pass conf dir {pull}18870[#18870] (issue: {issue}18689[#18689])

Query DSL::
* Fix silently accepting malformed queries {pull}20515[#20515] (issue: {issue}20500[#20500])
* query_string_query should take term length into consideration when fuzziness is auto {pull}20299[#20299] (issue: {issue}15972[#15972])

Recovery::
* Fix concurrency issues between cancelling a relocation and marking shard as relocated {pull}20443[#20443]

Reindex API::
* Fix reindex with transport client {pull}19997[#19997] (issues: {issue}19773[#19773], {issue}19979[#19979])
* Make reindex and lang-javascript compatible {pull}19933[#19933]

Scripting::
* Fix Javascript OOM build Failure {pull}20307[#20307]
* Fix propagating the default value for script settings {pull}20183[#20183] (issue: {issue}20159[#20159])
* Catch and wrap AssertionError and NoClassDefFoundError in groovy scripts {pull}19958[#19958] (issues: {issue}19806[#19806], {issue}19923[#19923])

Search::
* Throw error when trying to fetch fields from source and source is disabled {pull}20424[#20424] (issues: {issue}20093[#20093], {issue}20408[#20408])
* Source filtering should keep working when the source contains numbers greater than `Long.MAX_VALUE`. {pull}20278[#20278] (issue: {issue}11508[#11508])
* Fix NPE when running a range query on a `scaled_float` with no upper bound. {pull}20253[#20253]
* Add ref-counting to SearchContext to prevent accessing already closed readers {pull}20095[#20095] (issue: {issue}20008[#20008])
* Fix NPE during search with source filtering if the source is disabled. {pull}20093[#20093] (issue: {issue}7758[#7758])
* Restore assignment of time value when deserializing a scroll instance {pull}19977[#19977] (issue: {issue}18820[#18820])
* Fix explain output for dfs query {pull}19972[#19972] (issue: {issue}15369[#15369])

Settings::
* Validate max thread/merge settings {pull}20383[#20383] (issue: {issue}20380[#20380])
* Fix filter cache setting to allow percentages {pull}20335[#20335] (issue: {issue}20330[#20330])
* Move cluster.routing.allocation.same_shard.host setting to new settings infrastructure {pull}20046[#20046] (issue: {issue}20045[#20045])

Stats::
* Fix FieldStats deserialization of `ip` field {pull}20522[#20522] (issue: {issue}20516[#20516])

Translog::
* Fix RAM usage estimation of LiveVersionMap. {pull}20123[#20123] (issue: {issue}19787[#19787])



[[upgrade-5.0.0-beta1]]
[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.2.0 {pull}20147[#20147] (issue: {issue}20092[#20092])
* Update to jackson 2.8.1 {pull}18939[#18939] (issue: {issue}18076[#18076])

Network::
* Upgrade to Netty 4.1.5 {pull}20222[#20222] (issue: {issue}19786[#19786])

Scripting::
* Dependencies: Updates to mustache 0.9.3 {pull}20337[#20337]


